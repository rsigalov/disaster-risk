c(F3 = F3, F4 = F4, F5 = F5, F6 = F6, F7 = F7, F8 = F8, F9 = F9, F10 = F10)
}
ss <- multiroot(f = model, start = c(-1,1,1,1,1,1,1,1))$root
λkk <- (-ss[1])/(ss[4]-ss[1])
λka <- (λca + (λra - λca)*rrhoA)/(-λrk+λck)
ss <- multiroot(f = model, start = c(-1,1,1,1,1,1,1,1))$root
λkk <- (-ss[1])/(ss[4]-ss[1])
λka <- (ss[5] + (ss[8] - ss[5])*rrhoA)/(-ss[4]+ss[1])
ss
λka
λkk
vTFP <- rep(0.01, 100)
vCapital <- rep(0, 100)
for (i in seq(2, 100, 1)) {
vTFP[i] <- vTFP[i - 1] * rrhoA
vCapital[i] <- vCapital[i - 1] * λkk + vTFP[i - 1] * ss[9]
}
vOutput <- rep(0, 100)
for (i in seq(1, 100, 1)) {
vOutput[i] <- vOutput[i] * ss[3] + vTFP[i] * ss[7]
}
plot(vOutput)
plot(vOutput)
theta = rep(0,100,1)
theta
theta(1)
theta[1]
theta[2]
theta = rep(0, 100)
theta[2]
theta
rbinom(n = 100, prob = pi)
rbinom(size = 100, prob = pi, n = 2)
rbinom(size = 100, prob = pi, n = 1)
rbinom(size = 100, prob = pi, n = 100)
rbinom(100,1,pi)
v = 1;
pi = 0.1;
rbinom(100,1,pi)
for (itrade in seq(1,length(isInformed))) {
print(itrade)
}
isInformed <- rbinom(100,1,pi)
for (itrade in seq(1,length(isInformed))) {
print(itrade)
}
rbinom(1,1,0.5)
rbinom(1,1,0.5)
rbinom(1,1,0.5)
rbinom(1,1,0.5)
rbinom(1,1,0.5)
nSimulations <- 10
nTrades <- 100
mTheta <- matrix(0, nTrades, nSimulations)
theta[1,]
theta[1,:]
mTheta[1,:]
mTheta[1,]
rbinom(100, 1, pi)
rbinom(100, 2, pi)
rbinom(100, 10, pi)
rbinom(100, 1, pi)
pi = 0.5;
nSimulations <- 10
nTrades <- 100
mTheta <- matrix(0, nTrades, nSimulations)
mTheta[1,] <- rep(0.5, nSimulations)
for (iSimulation in seq(1, nSimulations)) {
isInformed <- rbinom(100, 1, pi)
for (iTrade in seq(2,length(isInformed))) {
# Generating random trades:
if (isInformed[iTrade] == 1) {
vTradeDirection[iTrade] <- 1
} else if rbinom(1,1,0.5) == 1 {
vTradeDirection[iTrade] <- 1
} else {
vTradeDirection[iTrade] <- -1
}
# Updating thetas:
oldTheta <- mTheta[iTrade - 1, iSimulation]
if (vTradeDirection[iTrade] == 1) {
mTheta[iTrade, iSimulation] <- (1 + pi)*0.5*oldTheta/(pi*oldTheta + (1-pi)*0.5)
} else {
mTheta[iTrade, iSimulation] <- (1 - pi)*0.5*oldTheta/(pi*(1-oldTheta) + (1-pi)*0.5)
}
}
}
pi = 0.5;
nSimulations <- 10
nTrades <- 100
mTheta <- matrix(0, nTrades, nSimulations)
mTheta[1,] <- rep(0.5, nSimulations)
for (iSimulation in seq(1, nSimulations)) {
isInformed <- rbinom(100, 1, pi)
vTradeDirection <- rep(0, nTrades)
for (iTrade in seq(2,length(isInformed))) {
# Generating random trades:
if (isInformed[iTrade] == 1) {
vTradeDirection[iTrade] <- 1
} else if rbinom(1,1,0.5) == 1 {
vTradeDirection[iTrade] <- 1
} else {
vTradeDirection[iTrade] <- -1
}
# Updating thetas:
oldTheta <- mTheta[iTrade - 1, iSimulation]
if (vTradeDirection[iTrade] == 1) {
mTheta[iTrade, iSimulation] <- (1 + pi)*0.5*oldTheta/(pi*oldTheta + (1-pi)*0.5)
} else {
mTheta[iTrade, iSimulation] <- (1 - pi)*0.5*oldTheta/(pi*(1-oldTheta) + (1-pi)*0.5)
}
}
}
for (iSimulation in seq(1, nSimulations)) {
isInformed <- rbinom(100, 1, pi)
vTradeDirection <- rep(0, nTrades)
for (iTrade in seq(2,length(isInformed))) {
# Generating random trades:
if (isInformed[iTrade] == 1) {
vTradeDirection[iTrade] <- 1
} else if (rbinom(1,1,0.5) == 1) {
vTradeDirection[iTrade] <- 1
} else {
vTradeDirection[iTrade] <- -1
}
# Updating thetas:
oldTheta <- mTheta[iTrade - 1, iSimulation]
if (vTradeDirection[iTrade] == 1) {
mTheta[iTrade, iSimulation] <- (1 + pi)*0.5*oldTheta/(pi*oldTheta + (1-pi)*0.5)
} else {
mTheta[iTrade, iSimulation] <- (1 - pi)*0.5*oldTheta/(pi*(1-oldTheta) + (1-pi)*0.5)
}
}
}
mTheta
plot(mTheta)
pi = 0.25;
nSimulations <- 10
nTrades <- 100
mTheta <- matrix(0, nTrades, nSimulations)
mTheta[1,] <- rep(0.5, nSimulations)
for (iSimulation in seq(1, nSimulations)) {
isInformed <- rbinom(100, 1, pi)
vTradeDirection <- rep(0, nTrades)
for (iTrade in seq(2,length(isInformed))) {
# Generating random trades:
if (isInformed[iTrade] == 1) {
vTradeDirection[iTrade] <- 1
} else if (rbinom(1,1,0.5) == 1) {
vTradeDirection[iTrade] <- 1
} else {
vTradeDirection[iTrade] <- -1
}
# Updating thetas:
oldTheta <- mTheta[iTrade - 1, iSimulation]
if (vTradeDirection[iTrade] == 1) {
mTheta[iTrade, iSimulation] <- (1 + pi)*0.5*oldTheta/(pi*oldTheta + (1-pi)*0.5)
} else {
mTheta[iTrade, iSimulation] <- (1 - pi)*0.5*oldTheta/(pi*(1-oldTheta) + (1-pi)*0.5)
}
}
}
mTheta
dfTheta <- data.frame(mTheta)
dfTheta
library("reshape")
library("ggplot2")
dfTheta$trade <- seq(1, nTrades, 1)
dfTheta <- melt(dfTheta, id.vars = "trade")
dfTheta
ggplot(dfTheta, aes(x = trade, y = value, color = variable)) +
geom_line()
ggplot(dfTheta, aes(x = trade, y = value, color = variable)) +
geom_line() + geom_point()
nSimulations <- 500
nTrades <- 200
dfTheta <- data.frame(pi = c(NA), trade = c(NA), meanTheta = c(NA), sdTheta(NA))
dfTheta <- data.frame(pi = c(NA), trade = c(NA), meanTheta = c(NA), sdTheta = c(NA))
dfTheta
mTheta <- matrix(0, nTrades, nSimulations)
mTheta[1,] <- rep(0.5, nSimulations)
for (iSimulation in seq(1, nSimulations)) {
isInformed <- rbinom(100, 1, pi)
vTradeDirection <- rep(0, nTrades)
for (iTrade in seq(2,length(isInformed))) {
# Generating random trades:
if (isInformed[iTrade] == 1) {
vTradeDirection[iTrade] <- 1
} else if (rbinom(1,1,0.5) == 1) {
vTradeDirection[iTrade] <- 1
} else {
vTradeDirection[iTrade] <- -1
}
# Updating thetas:
oldTheta <- mTheta[iTrade - 1, iSimulation]
if (vTradeDirection[iTrade] == 1) {
mTheta[iTrade, iSimulation] <- (1 + pi)*0.5*oldTheta/(pi*oldTheta + (1-pi)*0.5)
} else {
mTheta[iTrade, iSimulation] <- (1 - pi)*0.5*oldTheta/(pi*(1-oldTheta) + (1-pi)*0.5)
}
}
}
dfThetaTmp <- data.frame(mTheta)
dfThetaTmp$trade <- seq(1, nTrades, 1)
dfThetaTmp <- melt(dfThetaTmp, id.vars = "trade")
dfThetaTmp
rowMeans(mTheta)
thetaMeans <- rowMeans(mTheta)
apply(mTheta, 1, sd)
apply(mTheta, 2, sd)
apply(mTheta, 1, sd)
nSimulations <- 500
nTrades <- 200
dfTheta <- data.frame(pi = c(NA), trade = c(NA), meanTheta = c(NA), sdTheta = c(NA))
# Now Simulating many many and comparing for different pi
for (pi in c(0.05, 0.15, 0.25, 0.5)) {
mTheta <- matrix(0, nTrades, nSimulations)
mTheta[1,] <- rep(0.5, nSimulations)
for (iSimulation in seq(1, nSimulations)) {
isInformed <- rbinom(100, 1, pi)
vTradeDirection <- rep(0, nTrades)
for (iTrade in seq(2,nTrades)) {
# Generating random trades:
if (isInformed[iTrade] == 1) {
vTradeDirection[iTrade] <- 1
} else if (rbinom(1,1,0.5) == 1) {
vTradeDirection[iTrade] <- 1
} else {
vTradeDirection[iTrade] <- -1
}
# Updating thetas:
oldTheta <- mTheta[iTrade - 1, iSimulation]
if (vTradeDirection[iTrade] == 1) {
mTheta[iTrade, iSimulation] <- (1 + pi)*0.5*oldTheta/(pi*oldTheta + (1-pi)*0.5)
} else {
mTheta[iTrade, iSimulation] <- (1 - pi)*0.5*oldTheta/(pi*(1-oldTheta) + (1-pi)*0.5)
}
}
}
thetaMeans <- rowMeans(mTheta)
dfThetaTmp <- data.frame(pi = rep(pi, nTrades),
trade = seq(1,nTrades, 1),
meanTheta = apply(mTheta, 1, mean),
sdTheta = apply(mTheta, 1, sd))
dfTheta <- rbind(dfTheta, dfThetaTmp)
}
nSimulations <- 500
nTrades <- 200
dfTheta <- data.frame(pi = c(NA), trade = c(NA), meanTheta = c(NA), sdTheta = c(NA))
# Now Simulating many many and comparing for different pi
for (pi in c(0.05, 0.15, 0.25, 0.5)) {
mTheta <- matrix(0, nTrades, nSimulations)
mTheta[1,] <- rep(0.5, nSimulations)
for (iSimulation in seq(1, nSimulations)) {
isInformed <- rbinom(nTrades, 1, pi)
vTradeDirection <- rep(0, nTrades)
for (iTrade in seq(2,nTrades)) {
# Generating random trades:
if (isInformed[iTrade] == 1) {
vTradeDirection[iTrade] <- 1
} else if (rbinom(1,1,0.5) == 1) {
vTradeDirection[iTrade] <- 1
} else {
vTradeDirection[iTrade] <- -1
}
# Updating thetas:
oldTheta <- mTheta[iTrade - 1, iSimulation]
if (vTradeDirection[iTrade] == 1) {
mTheta[iTrade, iSimulation] <- (1 + pi)*0.5*oldTheta/(pi*oldTheta + (1-pi)*0.5)
} else {
mTheta[iTrade, iSimulation] <- (1 - pi)*0.5*oldTheta/(pi*(1-oldTheta) + (1-pi)*0.5)
}
}
}
thetaMeans <- rowMeans(mTheta)
dfThetaTmp <- data.frame(pi = rep(pi, nTrades),
trade = seq(1,nTrades, 1),
meanTheta = apply(mTheta, 1, mean),
sdTheta = apply(mTheta, 1, sd))
dfTheta <- rbind(dfTheta, dfThetaTmp)
}
dfTheta
dfTheta
ggplot(dfTheta, aes(x = trade,
y = meanTheta,
lower = meanTheta - 1.96 * sdTheta/sqrt(nSimulations),
upper = meanTheta + 1.96 * sdTheta/sqrt(nSimulations),
color = pi)) +
geom_line()
ggplot(dfTheta, aes(x = trade,
y = meanTheta,
lower = meanTheta - 1.96 * sdTheta/sqrt(nSimulations),
upper = meanTheta + 1.96 * sdTheta/sqrt(nSimulations),
color = factor(pi))) +
geom_line()
dfTheta <-
ggplot(dfTheta, aes(x = trade,
y = meanTheta,
lower = meanTheta - 1.96 * sdTheta/sqrt(nSimulations),
upper = meanTheta + 1.96 * sdTheta/sqrt(nSimulations),
color = factor(pi))) +
geom_line() + geom_ribbon()
dim(tdTheta)
dim(dfTheta)
dims(dfTheta)
dim(dfTheta)
dfTheta
nSimulations <- 1000
nTrades <- 200
dfTheta <- data.frame(pi = c(NA), trade = c(NA), meanTheta = c(NA), sdTheta = c(NA))
# Now Simulating many many and comparing for different pi
for (pi in c(0.05, 0.15, 0.25, 0.5)) {
mTheta <- matrix(0, nTrades, nSimulations)
mTheta[1,] <- rep(0.5, nSimulations)
for (iSimulation in seq(1, nSimulations)) {
isInformed <- rbinom(nTrades, 1, pi)
vTradeDirection <- rep(0, nTrades)
for (iTrade in seq(2,nTrades)) {
# Generating random trades:
if (isInformed[iTrade] == 1) {
vTradeDirection[iTrade] <- 1
} else if (rbinom(1,1,0.5) == 1) {
vTradeDirection[iTrade] <- 1
} else {
vTradeDirection[iTrade] <- -1
}
# Updating thetas:
oldTheta <- mTheta[iTrade - 1, iSimulation]
if (vTradeDirection[iTrade] == 1) {
mTheta[iTrade, iSimulation] <- (1 + pi)*0.5*oldTheta/(pi*oldTheta + (1-pi)*0.5)
} else {
mTheta[iTrade, iSimulation] <- (1 - pi)*0.5*oldTheta/(pi*(1-oldTheta) + (1-pi)*0.5)
}
}
}
thetaMeans <- rowMeans(mTheta)
dfThetaTmp <- data.frame(pi = rep(pi, nTrades),
trade = seq(1,nTrades, 1),
meanTheta = apply(mTheta, 1, mean),
sdTheta = apply(mTheta, 1, sd))
dfTheta <- rbind(dfTheta, dfThetaTmp)
}
dfTheta <- dfTheta[2:dim(tdTheta)[1],]
ggplot(dfTheta, aes(x = trade,
y = meanTheta,
ymin = meanTheta - 1.96 * sdTheta/sqrt(nSimulations),
ymax = meanTheta + 1.96 * sdTheta/sqrt(nSimulations),
color = factor(pi))) +
geom_line() + geom_ribbon()
dfTheta <- dfTheta[2:dim(dfTheta)[1],]
ggplot(dfTheta, aes(x = trade,
y = meanTheta,
ymin = meanTheta - 1.96 * sdTheta/sqrt(nSimulations),
ymax = meanTheta + 1.96 * sdTheta/sqrt(nSimulations),
color = factor(pi))) +
geom_line() + geom_ribbon()
ggplot(dfTheta, aes(x = trade,
y = meanTheta,
ymin = meanTheta - 1.96 * sdTheta/sqrt(nSimulations),
ymax = meanTheta + 1.96 * sdTheta/sqrt(nSimulations),
color = factor(pi))) +
geom_line() + geom_ribbon(alpha=0.3)
ggplot(dfTheta, aes(x = trade,
y = meanTheta,
ymin = meanTheta - 1.96 * sdTheta/sqrt(nSimulations),
ymax = meanTheta + 1.96 * sdTheta/sqrt(nSimulations),
fill = factor(pi))) +
geom_line() + geom_ribbon(alpha=0.3)
ggplot(dfTheta, aes(x = trade,
y = meanTheta,
ymin = meanTheta - 1.96 * sdTheta/sqrt(nSimulations),
ymax = meanTheta + 1.96 * sdTheta/sqrt(nSimulations),
fill = factor(pi), color = factor(pi))) +
geom_line() + geom_ribbon(alpha=0.3)
pi = 0.25;
nSimulations <- 10
nTrades <- 100
mTheta <- matrix(0, nTrades, nSimulations)
mTheta[1,] <- rep(0.5, nSimulations)
for (iSimulation in seq(1, nSimulations)) {
isInformed <- rbinom(100, 1, pi)
vTradeDirection <- rep(0, nTrades)
for (iTrade in seq(2,length(isInformed))) {
# Generating random trades:
if (isInformed[iTrade] == 1) {
vTradeDirection[iTrade] <- 1
} else if (rbinom(1,1,0.5) == 1) {
vTradeDirection[iTrade] <- 1
} else {
vTradeDirection[iTrade] <- -1
}
# Updating thetas:
oldTheta <- mTheta[iTrade - 1, iSimulation]
if (vTradeDirection[iTrade] == 1) {
mTheta[iTrade, iSimulation] <- (1 + pi)*0.5*oldTheta/(pi*oldTheta + (1-pi)*0.5)
} else {
mTheta[iTrade, iSimulation] <- (1 - pi)*0.5*oldTheta/(pi*(1-oldTheta) + (1-pi)*0.5)
}
}
}
dfTheta <- data.frame(mTheta)
dfTheta$trade <- seq(1, nTrades, 1)
dfTheta <- melt(dfTheta, id.vars = "trade")
ggplot(dfTheta, aes(x = trade, y = value, color = variable)) +
geom_line() + geom_point()
1+1
install.packages("nloptr")
library("nloptr")
library("ggplot2")
library("data.table")
library("dplyr")
library("reshape")
library("readr")
library("stargazer")
setwd("~/Documents/PhD/disaster-risk-revision/")
# Loading returns on portfolios sorted by individual disaster measure:
ret_ind <- read_csv("estimated_data/ind_disaster_sorts/port_sort_ret.csv") %>%
dplyr::rename(date = X1)
ret_agg <- read_csv("estimated_data/ind_disaster_sorts/port_sort_agg_ret.csv") %>%
dplyr::rename(date = X1)
bm_ind <- read_csv("estimated_data/ind_disaster_sorts/port_sort_bm.csv") %>%
dplyr::rename(date = X1)
bm_agg <- read_csv("estimated_data/ind_disaster_sorts/port_sort_agg_bm.csv") %>%
dplyr::rename(date = X1)
op_ind <- read_csv("estimated_data/ind_disaster_sorts/port_sort_op.csv") %>%
dplyr::rename(date = X1)
op_agg <- read_csv("estimated_data/ind_disaster_sorts/port_sort_agg_op.csv") %>%
dplyr::rename(date = X1)
setwd("~/Documents/PhD/disaster-risk-revision/")
# Loading returns on portfolios sorted by individual disaster measure:
ret_ind <- read_csv("estimated_data/ind_disaster_sorts/port_sort_ret.csv") %>%
dplyr::rename(date = X1)
setwd("~/Documents/PhD/disaster-risk-revision/")
# Loading returns on portfolios sorted by individual disaster measure:
ret_ind <- read_csv("estimated_data/disaster_sorts/port_sort_ret.csv") %>%
dplyr::rename(date = X1)
ret_agg <- read_csv("estimated_data/disaster_sorts/port_sort_agg_ret.csv") %>%
dplyr::rename(date = X1)
bm_ind <- read_csv("estimated_data/disaster_sorts/port_sort_bm.csv") %>%
dplyr::rename(date = X1)
bm_agg <- read_csv("estimated_data/disaster_sorts/port_sort_agg_bm.csv") %>%
dplyr::rename(date = X1)
op_ind <- read_csv("estimated_data/disaster_sorts/port_sort_op.csv") %>%
dplyr::rename(date = X1)
op_agg <- read_csv("estimated_data/disaster_sorts/port_sort_agg_op.csv") %>%
dplyr::rename(date = X1)
ret_ind_means <- op_ind %>%
filter(days %in% c(-99,30,60,120,180)) %>%
mutate(vw_diff = vw_5 - vw_1, ew_diff = ew_5 - ew_1) %>%
select(days, variable, ew_1, ew_2, ew_3, ew_4, ew_5, ew_diff,
vw_1, vw_2, vw_3, vw_4, vw_5, vw_diff) %>%
group_by(variable, days) %>%
mutate_all(function(x) 12*x) %>%
summarize_all(mean, na.rm = T)
comp_port_plots(bm_ind, bm_agg, "VW")
comp_port_plots(bm_ind, bm_agg, "EW")
ret_ind_means <- op_ind %>%
filter(days %in% c(-99,30,60,120,180)) %>%
mutate(vw_diff = vw_5 - vw_1, ew_diff = ew_5 - ew_1) %>%
select(days, variable, ew_1, ew_2, ew_3, ew_4, ew_5, ew_diff,
vw_1, vw_2, vw_3, vw_4, vw_5, vw_diff) %>%
group_by(variable, days) %>%
mutate_all(function(x) 12*x) %>%
summarize_all(mean, na.rm = T)
ret_agg_means <- op_agg %>%
filter(days %in% c(-99,30,60,120,180)) %>%
mutate(vw_diff = vw_1 - vw_5, ew_diff = ew_1 - ew_5) %>%
select(days, variable, ew_1, ew_2, ew_3, ew_4, ew_5, ew_diff,
vw_1, vw_2, vw_3, vw_4, vw_5, vw_diff) %>%
group_by(variable, days) %>%
# mutate_all(function(x) 12*x) %>%
summarize_all(mean, na.rm = T)
# Combining them together:
convert_for_plotting <- function(df, port_type_str) {
# Subsetting columns
df <- df %>%
filter(days %in% c(30,60,120,180)) %>%
filter(variable %in% c("D_clamp", "rn_prob_20", "rn_prob_80"))
# Picking the right columns according to portfolio type specified
if (port_type_str == "VW") {
df <- df %>% select(days, variable, vw_1, vw_2, vw_3, vw_4, vw_5)
} else if (port_type_str == "EW") {
df <- df %>% select(days, variable, ew_1, ew_2, ew_3, ew_4, ew_5)
} else {
stop(paste("No portfolio type", port_type_str))
}
# Melting the dataframes
df %>%
group_by(variable, days) %>%
mutate_all(function(x) x*12) %>%
summarize_all(mean, na.rm = T) %>%
data.table() %>% melt(id.vars = c("days", "variable")) %>%
dplyr::rename(port = variable.1) %>% # renaming variable for portfolios
mutate(port = as.numeric(substr(port, 4, 4))) %>%  # Converting portfolio names to numbers
mutate(port_type = port_type_str) %>% data.table()
}
comp_port_plots <- function(df_ind, df_agg, port_type_str) {
ret_melt_ew_ind <- convert_for_plotting(df_ind, port_type_str) %>%
mutate(sorting_var_type = "Individual")
# Renaming portfolios for beta sorts: call the most exposed to disaster as 5 and least as 1
ret_melt_ew_agg <- convert_for_plotting(df_agg, port_type_str) %>%
mutate(port = 6 - port) %>%
mutate(sorting_var_type = "Beta")
ggplot(rbind(ret_melt_ew_agg, ret_melt_ew_ind), aes(x = port, y = value, color = sorting_var_type)) +
geom_line() +
facet_grid(variable ~ days)
}
comp_port_plots(bm_ind, bm_agg, "VW")
comp_port_plots(op_ind, op_agg, "VW")
comp_port_plots(bm_ind, bm_agg, "EW")
comp_port_plots(op_ind, op_agg, "EW")
comp_port_plots(bm_ind, bm_agg, "VW")
